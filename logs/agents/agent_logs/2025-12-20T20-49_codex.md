# Agent Log — Handoff: 20x2 Full Grid Plan (10% Final)

- Agent: Codex CLI
- Model: GPT-5.2
- Created (UTC): 2025-12-20T20:49:10+00:00

## Goal

Run the **paper grid** as a full **20×2** sweep (4 length sets × 5 shapes, Fold A/B) on **10% sample** for final results.

## Pre-registered grid decisions (locked)

- Length sets (A.2): A1, A2, A3, A4 as specified in `docs/TIME_AGG_EXPERIMENTS.md`.
- Shapes (A.1):
  1. Trailing contiguous windows.
  2. Gap windows with **g=1 only**.
  3. Bucketized windows with **bucket edges tied to the length set** (e.g., A2 edges = 1,3,6,12,24).
  4. Calendar windows (today + yesterday) **added on top of the base trailing windows**.
  5. Event-count windows with **N=50** (only).
- Entity set fixed: `device_ip`, `device_id`, `app_id`, `site_id`.
- TE and model params frozen (same as current sweeps).
- Evaluation: rolling-tail Fold A/B.

## Required implementation (next agent)

1. **Add a “full grid” sweep mode** (new script or extend `kaggle_clicks/run_sweep_family_a.py`) that:
   - Generates the 20 combinations (length set × shape) with the above choices.
   - Runs both Fold A and Fold B per combo (`--rolling-tail`).
   - **Resume/skip** logic: if `metrics.json` exists in the run dir, skip re-running.
   - Accepts `--sample-pct 10` and `--sample-parquet data/interim/train_sample_10pct.parquet`.
   - Writes a sweep summary (`summary.md`, `summary.csv`, `sweep_config.json`).
2. **Add/confirm 10% sample**:
   - `data/interim/train_sample_10pct.parquet` already created (4,042,711 rows).
   - `.gitignore` already covers `data/interim/`.
3. **Smoke test**:
   - Run a tiny grid (1% is acceptable since `deterministic_pct_mask` uses integer pct).
   - Confirm run outputs + summary formatting + resume logic.
4. **Run full 10% 20×2 grid**:
   - This will be long; explicit approval required because it violates the “>5 minute” guideline.
   - Use a high wall-time cap and ensure logs are stored under `runs/sweeps/...`.
5. **Postprocess**:
   - Use `kaggle_clicks/postprocess_sweep_inference.py` to generate `inference_vs_baseline.csv` (baseline = trailing A3).
   - Optionally add a small script to compute fold means/std for the paper table.

## Helpful references (existing artifacts)

- 1% Phase 2 sweep + inference:
  - `runs/sweeps/20251220_172052_rolling_tail_phase2_1pct_s1pct/summary.md`
  - `runs/sweeps/20251220_172052_rolling_tail_phase2_1pct_s1pct/inference_vs_baseline.csv`
- 5% promo sweep (R3/R5/R8) + inference:
  - `runs/sweeps/20251220_180811_rolling_tail_5pct_promo_s5pct/summary.md`
  - `runs/sweeps/20251220_180811_rolling_tail_5pct_promo_s5pct/inference_vs_baseline.csv`

## Notes on noise

- 10% + Fold A/B should be adequate for directional patterns; report effect sizes + CIs and emphasize consistency across folds.

